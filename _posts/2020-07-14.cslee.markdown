---
layout: post
title:  "오픈뱅킹 사용기"
description: 오픈뱅킹 테스트베드 사용법을 알려드립니다.
date:   2019-07-14 21:03:36 +0530
categories: 오픈뱅킹
---
안녕하세요 디셈버앤컴퍼니의 이창섭입니다.   
'FINT(핀트)'서비스에서 간편입출금 이체를 오픈뱅킹을 사용해서 구현했는데 그때 적용했던 기억을 되살려 오픈뱅킹 테스트 방법 및 후기에 대해 정리해 보았습니다.  

오픈뱅킹 어디서 많이 들어보셨고 주변에서 홍보하거나 이벤트하는 내용을 흔히 볼 수 있는데  
아마 은행권에서 모든 계좌 통합 조회 및 이체가 가능하다고 많이 보셨을 거에요   


[오픈뱅킹 계좌 조회 이미지]

핀트에서는 오픈뱅킹 API를 활용해서 간편입출금 기능을 구현했는데요  
음 작년 밋업데이 때 참석해서 개발자분과 질의응답하고 API 문서 참고해서 테스트 및 구현했으니 벌써 1년 정도 되어가네요   
1년 사이에 몇몇 내용도 바뀌고 추가된 기능도 있지만 오픈뱅킹 API 기능에 큰 틀은 변화가 없어요  

오픈뱅킹 API는 금융결제원 주도로 개발되었으며 모든 API가 RESTful로 되어있습니다.(자체인증 동의자료 전송 제외)   
먼저 API 문서는 [오픈뱅킹 개발자사이트](https://developers.openbanking.or.kr/guide/sdkdownload) 에서 개발가이드 -> 자료실 -> 오픈뱅킹공동업무 오픈API 명세서 최신버전을 받으면 됩니다.   

![api_file_link](/images/cslee/api_file_link.JPG)

문서에 매우 상세한 내용이 나와있는데 대부분 API 스펙과 관련된 부분이에요.   
만약 처음하시는 분이면 [오픈뱅킹 시작하기](https://developers.openbanking.or.kr/guide/start)를 먼저 참고해야 하는데요      
위 링크를 보면 개인이 오픈뱅킹 테스트베드에 로그인 후, 개발용 API key를 받아서 테스트 한 후에 이용신청하라고 나오는데   
제일 중요한 테스트를 어떻게 하는지 자세히 설명되어 있지 않네요   

테스트하는 방법으로 금융결제원에서 제공하는 로컬테스트페이지(java) 모듈을 받아서 하는 경우와 postman같은걸로 직접 REST API를 호출해서 하는 방법이 있습니다   
후자로 진행할 예정이고 테스트를 하기 위해서 먼저 로그인 후 API key를 받아서 OAuth로 인증 후 테스트에 사용할 테스트데이터를 먼저 입력해야 합니다.   

우선 오픈뱅킹 인증은 OAuth2.0을 적용하고 있고 크게 자체인증(2-legged) 또는 센터인증(3-legged)로 구분되어 있습니다  
* 자체인증  
  자체인증은 금융결제원(오픈뱅킹 API제공하는 쪽)과 이용기관(오픈뱅킹API를 사용하는 쪽, 즉 이 블로그의 구독자)간의 인증만 하면 오픈뱅킹 API를 사용할 수 있는 AccessToken이 주어지는데요  
  자체인증이 되기 위해서는 기본적으로 허들이 높습니다 (자본금 얼마 이상 및 보안요건 충족 등)  
  계좌번호를 API에 직접 사용할 수 있습니다  
* 센터인증  
  센터인증은 금융결제원, 이용기관, 개인(이용기관의 서비스를 사용하는 주체)이 각각 인증을 받는 형식이고  
  소규모 핀테크 회사는 센터인증을 통해서 오픈뱅킹 API를 사용하도록 되어 있습니다  
  계좌번호를 직접 사용할 수 없고 API에 금융결제원에서 받은 핀테크번호만 사용할 수 있습니다  

이 예제에서는 '센터인증'을 기준으로 설명드리겠습니다  
1. 오픈뱅킹 테스트베드의 이용기관 AccessToken 얻기
2. 오픈뱅킹 테스트베드의 개인 AccessToken 얻기  


센터인증을 하기위해 오픈뱅킹 API에서 '토큰발급 API'를 사용해서 이용기관 AccessToken을 가져옵니다  
이 AccessToken은 오픈뱅킹-이용기관 사이에서 사용되는 이용기관조회서비스 및 관리 영역에서 주로 사용됩니다.  

그러면 잔액조회, 이체 등과 같은 API에 사용되는 AccessToken은 어떻게 얻는지 알아봅시다.  
센터인증에서 금융결제원-이용기관 인증(이용기관 AccessToken얻기)은 위에서 했고, 금융결제원-이용기관-개인 인증 데이터(개인 AccessToken)가 필요합니다

[오픈뱅킹 설명이미지]
...
[계좌등록 오픈뱅킹 설명이미지]


이 AccessToken으로 오픈뱅킹의 잔액조회, 이체 등과 같은 API를 사용할 수 있는데요  
예를 들어 잔액조회 API를 테스트해 보겠습니다  






